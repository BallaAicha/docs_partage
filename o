Voici mes DTOS ::
package com.socgen.unibank.services.autotest.model.model;

import com.socgen.unibank.domain.base.AdminUser;
import com.socgen.unibank.domain.base.DocumentStatus;
import com.socgen.unibank.platform.domain.Domain;
import com.socgen.unibank.platform.domain.URN;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.Date;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class DocumentDTO  implements Domain {
    private URN urn;
   private String name;
   private String description;
   private DocumentStatus status;
   private List<MetaDataDTO> metadata;
    private Date creationDate;
    private Date modificationDate;
    private AdminUser createdBy;
    private AdminUser modifiedBy;
}

package com.socgen.unibank.services.autotest.model.model;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class MetaDataDTO {
    private String key;
    private String value;
}

package com.socgen.unibank.services.autotest.model.model;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;
import java.util.Map;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class CreateDocumentEntryRequest {
    private String name;
    private String description;
    private Map<String, String> metadata;
    private List<String> tags;
}

package com.socgen.unibank.services.autotest.model.model;

import io.swagger.v3.oas.annotations.Hidden;

@Hidden

public class GetDocumentEntryListRequest {

}

package com.socgen.unibank.services.autotest.model.model;

public enum DocumentStatus {
    ACTIVE, INACTIVE
}


Voici mes usecases ::
package com.socgen.unibank.services.autotest.model.usecases;
import com.socgen.unibank.platform.domain.Query;
import com.socgen.unibank.platform.models.RequestContext;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
import com.socgen.unibank.services.autotest.model.model.GetDocumentEntryListRequest;

import java.util.List;

public interface GetDocumentList  extends Query{
    List<DocumentDTO> handle(GetDocumentEntryListRequest input, RequestContext context);
}

package com.socgen.unibank.services.autotest.model.usecases;

import com.socgen.unibank.platform.domain.Command;
import com.socgen.unibank.platform.models.RequestContext;
import com.socgen.unibank.services.autotest.model.model.CreateDocumentEntryRequest;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;

public interface CreateDocument  extends Command {
    DocumentDTO handle(CreateDocumentEntryRequest input, RequestContext context);
}


package com.socgen.unibank.services.autotest.model;


import com.socgen.unibank.platform.models.RequestContext;

import com.socgen.unibank.services.autotest.model.model.CreateDocumentEntryRequest;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
import com.socgen.unibank.services.autotest.model.model.GetDocumentEntryListRequest;
import com.socgen.unibank.services.autotest.model.usecases.CreateDocument;
import com.socgen.unibank.services.autotest.model.usecases.GetDocumentList;
import io.leangen.graphql.annotations.GraphQLQuery;
import io.leangen.graphql.annotations.GraphQLRootContext;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.annotations.media.Schema;
import org.springframework.web.bind.annotation.RequestBody;
import io.swagger.v3.oas.annotations.tags.Tag;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Tag(name = "Document Management")
@RequestMapping(name = "documents", produces = "application/json")
public interface DocumentAPI extends GetDocumentList, CreateDocument {
    @Operation(
        summary = "Lists des documents",
        parameters = {
            @Parameter(ref = "entityIdHeader", required = true),

        }
    )
    @GetMapping("/documents")
    @GraphQLQuery(name = "documentEntries")
   // @RolesAllowed(Permissions.IS_GUEST)
    @Override
    List<DocumentDTO> handle(GetDocumentEntryListRequest input, @GraphQLRootContext @ModelAttribute RequestContext ctx);


    @Operation(
        summary = "Create a new document",
        parameters = {
        @Parameter(ref = "entityIdHeader", required = true),

    }
    )
    @PostMapping("/document")
    @GraphQLQuery(name = "createDocument")
    //@RolesAllowed(Permissions.IS_GUEST)
    @Override
    DocumentDTO handle(@RequestBody CreateDocumentEntryRequest input, @GraphQLRootContext @ModelAttribute RequestContext ctx);


}
Implémentation Usecases ::
package com.socgen.unibank.services.autotest.core.usecases;

import com.socgen.unibank.domain.base.AdminUser;
import com.socgen.unibank.platform.models.RequestContext;
import com.socgen.unibank.services.autotest.core.DocumentRepository;
import com.socgen.unibank.services.autotest.model.model.CreateDocumentEntryRequest;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
import com.socgen.unibank.services.autotest.model.model.MetaDataDTO;
import com.socgen.unibank.services.autotest.model.usecases.CreateDocument;
import org.springframework.stereotype.Service;
import com.socgen.unibank.domain.base.DocumentStatus;
import java.util.Date;
import java.util.stream.Collectors;

@Service
public class CreateDocumentImpl implements CreateDocument {

    private final DocumentRepository documentRepository;

    public CreateDocumentImpl(DocumentRepository documentRepository) {
        this.documentRepository = documentRepository;
    }

    @Override
    public DocumentDTO handle(CreateDocumentEntryRequest input, RequestContext context) {
        DocumentDTO newDocument = new DocumentDTO();
        newDocument.setName(input.getName());
        newDocument.setDescription(input.getDescription());
        newDocument.setStatus(DocumentStatus.CREATED);
        newDocument.setMetadata(input.getMetadata().entrySet().stream()
            .map(entry -> new MetaDataDTO(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList()));
        newDocument.setCreationDate(new Date());
        newDocument.setModificationDate(new Date());
        newDocument.setCreatedBy(new AdminUser("usmane@socgen.com"));
        newDocument.setModifiedBy(new AdminUser("usmane@socgen.com"));

        documentRepository.saveDocument(newDocument);
        return newDocument;
    }
}

package com.socgen.unibank.services.autotest.core.usecases;

import com.socgen.unibank.platform.models.RequestContext;
import com.socgen.unibank.services.autotest.core.DocumentRepository;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
import com.socgen.unibank.services.autotest.model.model.GetDocumentEntryListRequest;
import com.socgen.unibank.services.autotest.model.usecases.GetDocumentList;
import org.springframework.stereotype.Service;

import java.util.Comparator;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class GetDocumentListImpl implements GetDocumentList {
    private final DocumentRepository autoTestRepository;

    public GetDocumentListImpl(DocumentRepository autoTestRepository) {
        this.autoTestRepository = autoTestRepository;
    }

    @Override
    public List<DocumentDTO> handle(GetDocumentEntryListRequest input, RequestContext context) {
        List<DocumentDTO> entries = autoTestRepository.findAllDocuments();
        if (input != null) {
            entries = entries.stream()
                .sorted(Comparator.comparing(DocumentDTO::getCreationDate).reversed())
                .collect(Collectors.toList());
        }
        return entries;
    }
}

Repository ::
package com.socgen.unibank.services.autotest.core;

import com.socgen.unibank.services.autotest.model.model.DocumentDTO;

import java.util.List;
public interface DocumentRepository {
    List<DocumentDTO> findAllDocuments();

    void saveDocument(DocumentDTO document);
}


Repository Implementation :
//package com.socgen.unibank.services.autotest.gateways.outbound.persistence;
//
//import com.socgen.unibank.domain.base.AdminUser;
//import com.socgen.unibank.platform.domain.URN;
//import com.socgen.unibank.services.autotest.core.DocumentRepository;
//import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
//import com.socgen.unibank.services.autotest.model.model.MetaDataDTO;
//import lombok.AllArgsConstructor;
//import org.springframework.stereotype.Component;
//
//import java.util.ArrayList;
//import java.util.Date;
//import java.util.List;
//
//import com.socgen.unibank.domain.base.DocumentStatus;
//
//@Component
//@AllArgsConstructor
//public class DocumentRepoImpl implements DocumentRepository {
//
//    private final List<DocumentDTO> documents = new ArrayList<>();
//
////    @Override
////    public List<DocumentDTO> findAllDocuments() {
////        List<DocumentDTO> documents = new ArrayList<>();
////        documents.add(new DocumentDTO(
////            new URN(null),
////            "Document 1",
////            "Description of Document 1",
////            DocumentStatus.CREATED,
////            List.of(new MetaDataDTO("key1", "value1")),
////            new Date(),
////            new Date(),
////            new AdminUser("creator1"),
////            new AdminUser("modifier1")
////        ));
////        documents.add(new DocumentDTO(
////            new URN(null),
////            "Document 2",
////            "Description of Document 2",
////            DocumentStatus.CREATED,
////            List.of(new MetaDataDTO("key2", "value2")),
////            new Date(),
////            new Date(),
////            new AdminUser("creator2"),
////            new AdminUser("modifier2")
////        ));
////        return documents;
////    }
//
//    @Override
//    public void saveDocument(DocumentDTO document) {
//        documents.add(document);
//    }
//
//
//}

package com.socgen.unibank.services.autotest.gateways.outbound.persistence;

import com.socgen.unibank.services.autotest.core.DocumentRepository;

import com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa.DocumentEntity;
import com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa.DocumentjpaRepo;
import com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa.MetaDataEntity;
import com.socgen.unibank.services.autotest.model.model.DocumentDTO;
import com.socgen.unibank.services.autotest.model.model.MetaDataDTO;

import lombok.AllArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.stream.Collectors;

@Component
@AllArgsConstructor
public class DocumentRepoImpl implements DocumentRepository {

    private final DocumentjpaRepo documentRepositoryJpa;

    @Override
    public List<DocumentDTO> findAllDocuments() {
        // Charger toutes les entités Document depuis la base de données
        List<DocumentEntity> documents = documentRepositoryJpa.findAll();

        // Convertir les entités en DTO pour les retourner
        return documents.stream()
            .map(document -> new DocumentDTO(
                null, // URN can be set as per your logic
                document.getName(),
                document.getDescription(),
                document.getStatus(),
                document.getMetadata().stream()
                    .map(metaData -> new MetaDataDTO(metaData.getKey(), metaData.getValue()))
                    .collect(Collectors.toList()),
                document.getCreationDate(),
                document.getModificationDate(),
                null, // Mapping AdminUser can be added according to your requirements
                null
            ))
            .collect(Collectors.toList());
    }

    @Override
    public void saveDocument(DocumentDTO documentDTO) {

        DocumentEntity document = new DocumentEntity();

        document.setName(documentDTO.getName());
        document.setDescription(documentDTO.getDescription());
        document.setStatus(documentDTO.getStatus());
        document.setCreationDate(documentDTO.getCreationDate());
        document.setModificationDate(documentDTO.getModificationDate());
        document.setCreatedBy(documentDTO.getCreatedBy().getEmail());  // Assuming AdminUser has an `email` field
        document.setModifiedBy(documentDTO.getModifiedBy().getEmail());


        List<MetaDataEntity> metadataList = documentDTO.getMetadata().stream()
            .map(metadataDTO -> new MetaDataEntity(null, document, metadataDTO.getKey(), metadataDTO.getValue()))
            .collect(Collectors.toList());
        document.setMetadata(metadataList);

        documentRepositoryJpa.save(document);
    }
}

Voici mes entités ::
package com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa;
import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import com.socgen.unibank.domain.base.DocumentStatus;
import java.util.Date;
import java.util.List;

@Entity
@Table(name = "document")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class DocumentEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true)
    private String name;

    @Column(nullable = false)
    private String description;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private DocumentStatus status;

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "document", orphanRemoval = true)
    private List<MetaDataEntity> metadata;

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "creation_date", nullable = false)
    private Date creationDate;

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "modification_date", nullable = false)
    private Date modificationDate;

    @Column(nullable = false)
    private String createdBy;

    @Column(nullable = false)
    private String modifiedBy;
}

package com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa;

import org.springframework.data.jpa.repository.JpaRepository;

public interface DocumentjpaRepo extends JpaRepository<DocumentEntity, Long> {

}
package com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "metadata")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class MetaDataEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "document_id", nullable = false)
    private DocumentEntity document;

    @Column(nullable = false)
    private String key;

    @Column(nullable = false)
    private String value;
}
package com.socgen.unibank.services.autotest.gateways.outbound.persistence.jpa;

import org.springframework.data.jpa.repository.JpaRepository;

public interface MetaDatajpaRepo extends JpaRepository<MetaDataEntity, Long> {
}

Voici mes migrations ::
<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="1" author="Ousmane">
        <createTable tableName="document">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="creation_date" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="modification_date" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="modified_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>

<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="2" author="Ousmane">
        <createTable tableName="metadata">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="document_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="document_id"
                                 baseTableName="metadata"
                                 constraintName="fk_document_metadata"
                                 referencedColumnNames="id"
                                 referencedTableName="document"/>
    </changeSet>
</databaseChangeLog>


Question ::  je te demande de gérer Document et DocumentVersion selon la meme structure de code  et fais aussi une migration liquibase pour version
